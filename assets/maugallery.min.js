(function($) {
  $.fn.mauGallery = function(options) { var options = $.extend($.fn.mauGallery.defaults, options); var tagsCollection = []; return this.each(function() { $.fn.mauGallery.methods.createRowWrapper($(this)); if (options.lightBox) { $.fn.mauGallery.methods.createLightBox($(this), options.lightboxId, options.navigation); } $.fn.mauGallery.listeners(options); $(this).children(".gallery-item").each(function(index) { $.fn.mauGallery.methods.responsiveImageItem($(this)); $.fn.mauGallery.methods.moveItemInRowWrapper($(this)); $.fn.mauGallery.methods.wrapItemInColumn($(this), options.columns); var theTag = $(this).data("gallery-tag"); if (options.showTags && theTag !== undefined && tagsCollection.indexOf(theTag) === -1) { tagsCollection.push(theTag); } }); if (options.showTags) { $.fn.mauGallery.methods.showItemTags($(this), options.tagsPosition, tagsCollection); } $(this).fadeIn(500); }); };

  $.fn.mauGallery.defaults = { columns: 3, lightBox: true, lightboxId: null, showTags: true, tagsPosition: "bottom", navigation: true };

  $.fn.mauGallery.listeners = function(options) { $(".gallery-item").on("click", function() { if (options.lightBox && $(this).prop("tagName") === "IMG") { $.fn.mauGallery.methods.openLightBox($(this), options.lightboxId); } }); $(".gallery").on("click", ".nav-link", $.fn.mauGallery.methods.filterByTag); $(".gallery").on("click", ".mg-prev", () => $.fn.mauGallery.methods.prevImage(options.lightboxId)); $(".gallery").on("click", ".mg-next", () => $.fn.mauGallery.methods.nextImage(options.lightboxId)); };

  $.fn.mauGallery.methods = {
    createRowWrapper(e) { if (!e.children().first().hasClass("row")) { e.append('<div class="gallery-items-row row"></div>'); } },

    wrapItemInColumn(e, c) { if (c.constructor === Number) { e.wrap(`<div class='item-column mb-4 col-${Math.ceil(12 / c)}'></div>`); } else if (c.constructor === Object) { var classes = ""; if (c.xs) { classes += ` col-${Math.ceil(12 / c.xs)}`; } if (c.sm) { classes += ` col-sm-${Math.ceil(12 / c.sm)}`; } if (c.md) { classes += ` col-md-${Math.ceil(12 / c.md)}`; } if (c.lg) { classes += ` col-lg-${Math.ceil(12 / c.lg)}`; } if (c.xl) { classes += ` col-xl-${Math.ceil(12 / c.xl)}`; } e.wrap(`<div class='item-column mb-4${classes}'></div>`); } else { console.error(`Columns should be numbers or objects. Got ${typeof c}.`); } },

    moveItemInRowWrapper(e) { e.appendTo(".gallery-items-row"); },

    responsiveImageItem(e) { if (e.prop("tagName") === "IMG") { e.addClass("img-fluid"); } },

    openLightBox(e, id) { $(`#${id}`).find(".lightboxImage").attr("src", e.attr("src")); $(`#${id}`).modal("toggle"); },

    prevImage(id) { let active=null; $("img.gallery-item").each(function() { if ($(this).attr("src") === $(".lightboxImage").attr("src")) { active=$(this); } }); let tag=$(".tags-bar span.active-tag").data("images-toggle"); let imgs=[]; if (tag==="all") { $(".item-column").each(function() { if ($(this).children("img").length) { imgs.push($(this).children("img")); } }); } else { $(".item-column").each(function() { if ($(this).children("img").data("gallery-tag") === tag) { imgs.push($(this).children("img")); } }); } let i=0; $(imgs).each(function(index) { if ($(active).attr("src") === $(this).attr("src")) { i=index; } }); i=(i-1+imgs.length)%imgs.length; $(".lightboxImage").attr("src", $(imgs[i]).attr("src")); },

    nextImage(id) { let active=null; $("img.gallery-item").each(function() { if ($(this).attr("src") === $(".lightboxImage").attr("src")) { active=$(this); } }); let tag=$(".tags-bar span.active-tag").data("images-toggle"); let imgs=[]; if (tag==="all") { $(".item-column").each(function() { if ($(this).children("img").length) { imgs.push($(this).children("img")); } }); } else { $(".item-column").each(function() { if ($(this).children("img").data("gallery-tag") === tag) { imgs.push($(this).children("img")); } }); } let i=0; $(imgs).each(function(index) { if ($(active).attr("src") === $(this).attr("src")) { i=index; } }); i=(i+1)%imgs.length; $(".lightboxImage").attr("src", $(imgs[i]).attr("src")); },

    createLightBox(gallery, id, nav) { gallery.append(`<div class="modal fade" id="${id?id:"galleryLightbox"}" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-body">${nav?'<div class="mg-prev" style="cursor:pointer;position:absolute;top:50%;left:-15px;background:white;"><</div>':'<span style="display:none;" />'}<img class="lightboxImage img-fluid" alt="Contenu de l'image affichÃ©e dans la modale au clique"/>${nav?'<div class="mg-next" style="cursor:pointer;position:absolute;top:50%;right:-15px;background:white;}">></div>':'<span style="display:none;" />'}</div></div></div></div>`); },

    showItemTags(gallery, pos, tags) { var html='<li class="nav-item"><span class="nav-link active active-tag" data-images-toggle="all">Tous</span></li>'; $.each(tags, function(i,v) { html+=`<li class="nav-item active"><span class="nav-link" data-images-toggle="${v}">${v}</span></li>`; }); var row=`<ul class="my-4 tags-bar nav nav-pills">${html}</ul>`; if (pos==="bottom") { gallery.append(row); } else if (pos==="top") { gallery.prepend(row); } else { console.error(`Unknown tags position: ${pos}`); } },

    filterByTag() { if ($(this).hasClass("active-tag")) return; $(".active-tag").removeClass("active active-tag"); $(this).addClass("active-tag"); var tag=$(this).data("images-toggle"); $(".gallery-item").each(function() { $(this).parents(".item-column").hide(); if (tag==="all") { $(this).parents(".item-column").show(300); } else if ($(this).data("gallery-tag") === tag) { $(this).parents(".item-column").show(300); } }); }
  };
})(jQuery);
